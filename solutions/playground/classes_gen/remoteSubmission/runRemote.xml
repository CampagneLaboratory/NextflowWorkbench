<project name="nextflow-remote" default="submit">
  <dirname property="nextflow-remote.basedir" file="${ant.file.nextflow-remote}" />
  <property name="workflow.script" value="" />
  <property name="source.dir" location="${nextflow-remote.basedir}" />
  <property name="remote.job.dir" location="/home/gobyweb/nextflow-tests/1438699831767" />
  <property name="remote.username" value="gobyweb" />
  <property name="submission.machine" value="darla.med.cornell.edu" />
  <property name="jar.script" value="" />
  <property name="keyfile" location="${user.home}/.ssh/id_rsa" />
  
  <target name="create-job-dir">
    <sshexec host="${submission.machine}" username="${remote.username}" keyfile="${keyfile}" command="mkdir -p ${remote.job.dir}" />
  </target>
  
  <target name="copy-files" depends="create-job-dir">
    <scp todir="${remote.username}@${submission.machine}:${remote.job.dir}" keyfile="${keyfile}">
      <fileset dir="${source.dir}" />
    </scp>
  </target>
  
  <target name="grant-permissions" depends="copy-files">
    <sshexec host="${submission.machine}" username="${remote.username}" keyfile="${keyfile}" command="chmod a+x ${remote.job.dir}/runNextflow" />
  </target>
  
  <target name="submit" depends="copy-files, grant-permissions">
    <sshexec host="${submission.machine}" username="${remote.username}" keyfile="${keyfile}" command="cd ${remote.job.dir}; ./runNextflow ${remote.job.dir}/${workflow.script} ${remote.job.dir}/${jar.script} " />
  </target>
  
  <target name="clean">
    <sshexec host="${submission.machine}" username="${remote.username}" keyfile="${keyfile}" command="rm -rf ${remote.dir}" />
  </target>
</project>